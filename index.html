<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>7B Bank</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    button { padding: 5px 10px; margin: 3px; cursor: pointer; }
    .controls { text-align: center; margin-top: 15px; }
    #teacherControls { display: none; background: #fff; padding: 10px; border: 1px solid #ccc; }
    #loginPage { display: none; text-align: center; background: #fff; padding: 20px; border-radius: 10px; width: 300px; margin: 40px auto; box-shadow: 0 0 10px #ccc; }
    #studentPage { display: none; }
  </style>
</head>
<body>

  <h1>7B Bank</h1>

  <!-- Login Page -->
  <div id="loginPage">
    <h3>Student Login</h3>
    <input type="text" id="loginUsername" placeholder="Username"><br><br>
    <input type="password" id="loginPassword" placeholder="Password"><br><br>
    <button id="studentLoginBtn">Login</button>
    <hr>
    <button id="teacherLoginBtn">Teacher Login</button>
  </div>

  <!-- Student Page -->
  <div id="studentPage">
    <div class="controls">
      Signed in as: <span id="signedInAs">None</span>
      <button id="logoutBtn">Logout</button>
    </div>

    <table id="studentTable">
      <thead>
        <tr>
          <th>Student</th>
          <th>Balance ($)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Teacher Controls -->
  <div id="teacherControls">
    <h3>Teacher Controls</h3>
    <input type="text" id="newStudentName" placeholder="Student name">
    <input type="password" id="newStudentPassword" placeholder="Set student password">
    <button id="addStudent">Add Student</button>
    <button id="resetData">Reset Data</button>
    <table id="teacherTable">
      <thead>
        <tr>
          <th>Student</th>
          <th>Balance ($)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="logoutTeacher">Logout Teacher</button>
  </div>

  <script>
    const TEACHER_PASSWORD = "123";
    let data = JSON.parse(localStorage.getItem("bankData")) || { students: [] };
    let currentUser = null;
    let teacherMode = false;

    const loginPage = document.getElementById("loginPage");
    const studentPage = document.getElementById("studentPage");
    const teacherControls = document.getElementById("teacherControls");
    const studentTableBody = document.querySelector("#studentTable tbody");
    const teacherTableBody = document.querySelector("#teacherTable tbody");
    const signedInAs = document.getElementById("signedInAs");

    function saveData() {
      localStorage.setItem("bankData", JSON.stringify(data));
    }

    function showLoginPage() {
      loginPage.style.display = "block";
      studentPage.style.display = "none";
      teacherControls.style.display = "none";
    }

    function showStudentPage() {
      loginPage.style.display = "none";
      studentPage.style.display = "block";
      teacherControls.style.display = "none";
    }

    function showTeacherPage() {
      loginPage.style.display = "none";
      studentPage.style.display = "none";
      teacherControls.style.display = "block";
    }

    function updateSignedInDisplay() {
      signedInAs.textContent = currentUser || "None";
    }

    function renderTeacherTable() {
      teacherTableBody.innerHTML = "";
      data.students.forEach((s, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${s.name}</td>
          <td>${s.balance}</td>
          <td>
            <button onclick="depositMoney(${i})">Deposit</button>
            <button onclick="withdrawMoney(${i})">Withdraw</button>
            <button onclick="deleteStudent(${i})">Delete</button>
            <button onclick="viewPassword(${i})">View/Edit Password</button>
          </td>
        `;
        teacherTableBody.appendChild(row);
      });
    }

    function renderStudentView() {
      studentTableBody.innerHTML = "";
      const s = data.students.find(stu => stu.name === currentUser);
      if (!s) return;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${s.name}</td>
        <td>${s.balance}</td>
        <td><button onclick="transferMoney()">Transfer</button></td>
      `;
      studentTableBody.appendChild(row);
    }

    function depositMoney(index) {
      if (!teacherMode) return;
      const amount = parseFloat(prompt("Deposit amount:"));
      if (isNaN(amount) || amount <= 0) return;
      data.students[index].balance += amount;
      saveData();
      renderTeacherTable();
    }

    function withdrawMoney(index) {
      if (!teacherMode) return;
      const amount = parseFloat(prompt("Withdraw amount:"));
      if (isNaN(amount) || amount <= 0) return;
      data.students[index].balance -= amount;
      if (data.students[index].balance < 0) data.students[index].balance = 0;
      saveData();
      renderTeacherTable();
    }

    function deleteStudent(index) {
      if (!teacherMode) return;
      const name = data.students[index].name;
      if (confirm(`Delete ${name}'s account? This cannot be undone.`)) {
        data.students.splice(index, 1);
        saveData();
        renderTeacherTable();
      }
    }

    function viewPassword(index) {
      if (!teacherMode) return;
      const s = data.students[index];
      const newPass = prompt(`Password for ${s.name}:`, s.password);
      if (newPass && newPass.trim() !== "") {
        s.password = newPass.trim();
        saveData();
        renderTeacherTable();
      }
    }

    function transferMoney() {
      const from = data.students.find(s => s.name === currentUser);
      if (!from) return;
      const confirmPw = prompt(`Enter your password to confirm transfer:`);
      if (confirmPw !== from.password) return alert("Incorrect password.");

      const recipientName = prompt("Enter recipient username:");
      if (!recipientName) return;
      const to = data.students.find(s => s.name === recipientName);
      if (!to) return alert("Recipient not found.");
      if (to.name === from.name) return alert("You cannot transfer to yourself.");

      const amount = parseFloat(prompt(`Amount to send to ${to.name}:`));
      if (isNaN(amount) || amount <= 0) return;
      if (from.balance < amount) return alert("Not enough funds.");

      from.balance -= amount;
      to.balance += amount;
      saveData();
      renderStudentView();
      alert(`Transferred $${amount} to ${to.name}`);
    }

    document.getElementById("addStudent").onclick = () => {
      const name = document.getElementById("newStudentName").value.trim();
      const password = document.getElementById("newStudentPassword").value.trim();
      if (!name || !password) return alert("Name and password required.");
      if (data.students.some(s => s.name === name)) return alert("Name already exists.");
      data.students.push({ name, balance: 0, password });
      saveData();
      renderTeacherTable();
      document.getElementById("newStudentName").value = "";
      document.getElementById("newStudentPassword").value = "";
    };

    document.getElementById("resetData").onclick = () => {
      if (!confirm("Reset all data?")) return;
      localStorage.removeItem("bankData");
      data = { students: [] };
      renderTeacherTable();
    };

    document.getElementById("teacherLoginBtn").onclick = () => {
      const pw = prompt("Enter teacher password:");
      if (pw === TEACHER_PASSWORD) {
        teacherMode = true;
        showTeacherPage();
        renderTeacherTable();
      } else {
        alert("Wrong password.");
      }
    };

    document.getElementById("logoutTeacher").onclick = () => {
      teacherMode = false;
      showLoginPage();
    };

    document.getElementById("studentLoginBtn").onclick = () => {
      const name = document.getElementById("loginUsername").value.trim();
      const pw = document.getElementById("loginPassword").value.trim();
      const student = data.students.find(s => s.name === name);
      if (!student) return alert("No such user.");
      if (student.password !== pw) return alert("Wrong password.");

      currentUser = name;
      teacherMode = false;
      showStudentPage();
      updateSignedInDisplay();
      renderStudentView();
    };

    document.getElementById("logoutBtn").onclick = () => {
      currentUser = null;
      showLoginPage();
    };

    // Start at login screen
    showLoginPage();
  </script>
</body>
</html>
